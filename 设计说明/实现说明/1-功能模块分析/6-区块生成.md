# 说明
区块生成包括了三个过程
1. 委员会选举：选出每个epoch的委员会成员
2. 出块投票：  委员会中的一部分成员进行出块动作
3. 分片扩展：  当节点数到达一定程度时，进行自动分片

# 现有区块生成模式
在substrate中，链存在于client中，区块由共识生成，通过import_block导入到链中。 共识分为两类，事前确认型和事后确认型：
事前确认型是指在区块生成前，就已经确认本节点拥有出块权了，事前确认型的共识生成分以下几个阶段：
1. 生成一个异步的Proposer
2. proposer通过propose创建区块
3. 调用import_block纳入到链中

事后确认型是指区块预先生成，然后通过某种算法（一般是指Pow中的难度值）确认该区块是否有效，如果有效，就对区块封包，然后广播，如果无效，就重新生成并且检查一次，事后确认型共识分成以下几个阶段：
1. 立刻生成一个Proposer
2. proposer通过propose创建区块
3. 确认区块是否有效（挖矿）
4. 如果有效，调用import_block纳入到链中，然后重新转到1；否则转到2

所谓生成一个异步的proposer，其含义是只有当本节点拥有了创建区块的资格时，才返回这个proposer。因此获得proposer和创建proposal之间不再需要任何的待或是异步。

可以看出创建区块需要两个对象，client对象和transaction_pool对象， client对象用于确定区块的有效性以及导入新生成的区块，transaction-pool用于在创建区块过程中，获得可用的交易。

## 进一步交互
如果共识算法需要更进一步的链的信息，比如说根据链中最新导入的区块，重新修改proposer的生成算法和时间，或是共识根据最新的区块作一些其他的处理，比如说状态更新之类，那么可以实现一个BlockImport的特质，然后通过
# Pnyx的区块生成模式
Pnyx中的区块生成模式属于事前确认型，这个事前确认有两步：  
1. 通过VRF和投票回应，计算权重，这个过程需要一段时间
2. 根据权重作延时，这个过程也需要一段时间（需要的时间可能为0）

通过以上两步，就可以返回Proposer了，一旦Proposer返回：
1. 检查链（client）中是否有比自身更好的的区块，如果有，放弃出块
2. 如果没有，创建区块并且通过import_block导入到client(链)中
   
