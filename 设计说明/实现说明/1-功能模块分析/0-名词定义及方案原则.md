
# 名词定义：  
1. 区块 (Block)  
   每一段时间的交易
2. 时段 (epoch)  
   系统定义的连续的一系列的区块，称为时段。每个时段内的委员会成员不变。
3. 时隙 (slot)  
   在一个时段内的区块称为时隙，每个时段中的时隙总是从0开始
4. 委员会 (committee)   
   在一个时段内选出来的，可能在某个时隙进行投票的节点。节点首先要参与竞选，竞选成功后成为委员会成员。
5. 投票代表 (delegated)  
   在每个时段内选出的，可以对投票请求进行回应的委员会成员。这个是轮流的。
6. 最终确定化(Finalize)
   最终确定化是指某个区块不会被回滚了。最终确定化有两种方式，概率上的最终确定化（比特币和以太坊的6个区块，回滚的概率小于一定的值了，所以认为是最终确定化了）；数学上的最终确定化，在pnyx算法中，如果一个区块的投票者超过50%了，由于投票时需要检查前一区块信息，这意味着前一个区块被这个区块的超过50%投票者认可了，因此前一个区块就是被最终确定化了，这个是数学上的最终确定化）
7. 

# 方案原则
1. 所有在链下交易的，属于Message类型，通过扩充Message类型实现，转发等处理在protocol中实现。
2. 所有在链上的，实现Extrinsic，转发通过transaction-pool实现。
3. 需要跨分片处理的，实现CSA(Cross-Shard-Action)来实现，每个区块体中都有CSA域，而区块头中具有对应的哈希
4. 只有在区块已经被最终确定化的情况下，区块中的CSA数据才会被相应的跨分片处理者处理（中继链或是信标链）
5. 数据只在需要的必要的链中传输，这个有点难理解，我们用一个例子来说明：
   1. 当分片A中的节点A<sub>m</sub>需要转移资产数据给分片B中的节点B<sub>n</sub>时，分片A属于中继R<sub>A</sub>，而分片B属于中继R<sub>B</sub>，分片产生一组需要请求中继R<sub>B</sub>处理的CSA信息，并且生成对应哈希值，并且生成{目标R<sub>B</sub>,哈希值记录}对。 
   2. 当分片传输数据给中继R<sub>A</sub>时，中继R<sub>A</sub>只关心{目标R<sub>B</sub>,哈希值记录}对，并且根据{目标R<sub>B</sub>,哈希值记录}对将这个数据传通过信标链转送到了中继R<sub>B</sub>。
   3. 中继R<sub>B</sub>根据哈希从P2P网络中取出相应的CSA数据，然后进行处理。  
   可以看到，实际的CSA数据只有在产生者（分片A）和中继R<sub>B</sub>中传播和处理，中间过程中的中继R<sub>A</sub>和信标链都不关心实际的数据。 
   **这个被称为数据只在必要的链中传输**


# 第一阶段工作路线图
按照对现有网络分片的结果，设计完成路线图，其主要目的是每个阶段完成的内容都是可以测试和验证的。
1. 网络层工作
   1. 路由表、组播、广播、延时发送
   2. 与区块同步转发相关的协议改动
2. 多客户端实现
   1. 在一个上面启动多个客户端（信标、中继、分片）
3. 片内共识实现
   1. 委员会远举
   2. 出块投票
4. 跨分片交易相关的定义和实现
   1. 区块头和区块体改造
   2. 通过创世配置实现分片（一个信标、两个中继，4个分片）
   3. 跨分片交易实现
5. 弹性分片
   1. 弹性分片的数据结构设计及改造
   2. 弹性分片实现
6. 快速同步
   1. 状态快照
   2. 区块数据快照
   3. 按Epoch同步